<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rpi-sense</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">


    <script defer>
        let mainSetInterval
        let currentJson = {} //TODO: in pi ram

        let jsonDataFiles = {}

        fetch('/get_data')
            .then(response => response.json())
            .then(data => {
                currentJson = data

            })
            .catch(error => console.error('Error fetching JSON data:', error));

        fetch('/list_json_files') // Fetch list of JSON files
            .then(response => response.json())
            .then(files => {
                files.forEach(file => {
                    fetch(`data/${file}`) // Fetch each JSON file
                        .then(response => response.json())
                        .then(data => {
                            let nameString = `${file}`
                            jsonDataFiles[nameString] = data; // Process data



                            setTimeout(init, 500);
                            mainSetInterval = setInterval(run, 10000);


                        })
                        .catch(error => console.error(`Error fetching ${file}:`, error));
                });
            })
            .catch(error => console.error('Error fetching list of JSON files:', error));
        

        console.log('jsonData = jsonDataFiles["2024-01-09.json"]; updateCharts(true)')


    </script>


    <script src="{{ url_for('static', filename='js/lib/chart.umd.min.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/functions.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/init.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</head>
<body>
    <div id="header">
        <div id="currentValues">
            <div id="temperatureH">
                <span id="temperatureHVal">
                    - C
                </span>
            </div>
            <div id="pressureH">
                <span id="pressureHVal">
                    - bar
                </span>
            </div>
            <div id="humidityH">
                <span id="humidityHVal">
                    - %
                </span>
            </div>
        </div>
    </div>
    <div style="display:flex; justify-content:center;flex-wrap:wrap;margin-top:10px;" id="app">
        <div style="width: 95vw; height: 28vh; max-height: 28vh; margin:5px; padding:3px;"><canvas id="chartT"></canvas></div>
        <div style="width: 95vw; height: 28vh; max-height: 28vh; margin: 5px; padding: 3px; "><canvas id="chartH" "></canvas></div>
        <div style="width: 95vw; height: 28vh; max-height: 28vh; margin: 5px; padding: 3px; "><canvas id="chartP" "></canvas></div>
    </div>
</body>
</html>